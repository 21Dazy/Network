# 静态路由配置教程（Cisco Packet Tracer 8.2.1模拟环境）

## 目录
1. [实验概述](#实验概述)
2. [实验环境准备](#实验环境准备)
3. [静态路由技术原理](#静态路由技术原理)
4. [详细实验步骤](#详细实验步骤)
5. [验证配置结果](#验证配置结果)
6. [排除常见问题](#排除常见问题)
7. [扩展知识](#扩展知识)

## 实验概述

### 实验名称
静态路由配置

### 实验目的
掌握通过静态路由方式实现不同网段之间的连通性。

### 背景描述
假设校园网通过1台路由器连接到校园外的另1台路由器上，现要在路由器上做适当配置，实现校园网内部主机与校园网外部主机的相互通信。

## 实验环境准备

### 实验设备
- 路由器R2632（1台）- 校园内路由器
- 路由器R1762-01（1台）- 校园外路由器
- 交换机S2126G-01（1台）- 模拟校园内PC
- 交换机S2126G-02（1台）- 模拟校园外PC
- V35串行线缆（1条）- 连接两台路由器
- 直连线或交叉线（2条）- 连接路由器与交换机

### 实验拓扑
```
+------------------+                 +------------------+                +------------------+
|   交换机S2126G-01 |                 |      路由器      |                |      路由器      |                 +------------------+
|   (模拟校园内PC)  |-----------------|     R2632       |----------------|    R1762-01     |-----------------|  交换机S2126G-02  |
|   VLAN1接口      |     直连线       |     F1/1        |    V35线缆     |     F1/1        |     直连线      |  (模拟校园外PC)   |
| 172.16.1.11/24   |                 | 172.16.1.1/24    |                | 172.16.3.2/24    |                 |  VLAN1接口       |
| 网关:172.16.1.1  |                 | S1/2:172.16.2.1/24|                | S1/2:172.16.2.2/24|                | 172.16.3.22/24   |
|                  |                 |    (DCE端)       |                |    (DTE端)       |                 | 网关:172.16.3.2  |
+------------------+                 +------------------+                +------------------+                 +------------------+
      172.16.1.0/24                     |         |                           |         |                         172.16.3.0/24
                                        |         |                           |         |
                                        |         |                           |         |
                                        |         +---------------------------+         |
                                        |                 172.16.2.0/24                 |
                                        |                                               |
                                        |                                               |
                                        +-----------------------------------------------+
                                                      静态路由连接
```

### 网络地址规划
1. 校园内网络：172.16.1.0/24
   - R2632的F1/1接口：172.16.1.1/24（校园内网关）
   - S2126G-01的VLAN1接口：172.16.1.11/24

2. 路由器互联网络：172.16.2.0/24
   - R2632的S1/2接口：172.16.2.1/24（DCE端，需配置时钟频率）
   - R1762-01的S1/2接口：172.16.2.2/24（DTE端）

3. 校园外网络：172.16.3.0/24
   - R1762-01的F1/1接口：172.16.3.2/24（校园外网关）
   - S2126G-02的VLAN1接口：172.16.3.22/24

## 静态路由技术原理

### 路由器的工作原理
1. **路由器功能**：
   - 路由器是网络层设备，能够根据IP数据包头部信息进行路由选择
   - 可以连接不同网络，实现不同网段主机之间的通信
   - 隔离广播域，提高网络性能和安全性

2. **路由表**：
   - 路由器通过查询路由表来决定数据包的转发路径
   - 包含目标网络、子网掩码、下一跳地址或出接口等信息
   - 路由表决定了数据包如何从源地址到达目标地址

3. **路由表生成方式**：
   - **直连路由**：路由器接口配置IP地址后自动生成
   - **静态路由**：网络管理员手动配置
   - **动态路由**：通过路由协议自动学习（如RIP、OSPF、EIGRP等）

### 静态路由特点
1. **适用场景**：
   - 网络规模小，拓扑结构简单且变化不频繁
   - 安全性要求高的网络环境
   - 网络带宽有限的情况

2. **优点**：
   - 不占用带宽资源（无路由更新消息）
   - 安全性好（完全由管理员控制）
   - 设置简单，不需要复杂的协议知识

3. **缺点**：
   - 不能自动适应网络拓扑变化
   - 网络规模大时配置工作量大
   - 故障恢复能力差

### 静态路由命令格式
```
ip route 目标网络 子网掩码 {下一跳IP地址 | 出接口}
```

- **目标网络**：要到达的目标网络地址
- **子网掩码**：目标网络的子网掩码
- **下一跳IP地址**：到达目标网络需要经过的下一个路由器的IP地址
- **出接口**：数据包从本地路由器的哪个接口发出

## 详细实验步骤

### 步骤1：创建实验拓扑

1. 启动Cisco Packet Tracer 8.2.1
2. 添加设备：
   - 放置两台路由器（1841或2811型号），分别命名为R2632和R1762-01
   - 放置两台交换机（2960或类似型号），分别命名为S2126G-01和S2126G-02
3. 连接设备：
   - 使用V35串行线缆连接R2632的Serial1/2(DCE)和R1762-01的Serial1/2(DTE)
     - 注意：选择串行线缆时，确保选择正确的DCE/DTE线型
   - 使用直连线或交叉线连接R2632的F1/1和S2126G-01
   - 使用直连线或交叉线连接R1762-01的F1/1和S2126G-02

### 步骤2：配置校园内路由器R2632

1. 连接到路由器R2632的控制台：
   - 在Packet Tracer中，点击路由器图标
   - 选择"CLI"标签页

2. 进入特权模式和全局配置模式：
   ```
   Router> enable
   Router# configure terminal
   Router(config)# hostname R2632
   ```

3. 配置FastEthernet接口（连接校园内网络）：
   ```
   R2632(config)# interface fastEthernet 1/1
   R2632(config-if)# ip address 172.16.1.1 255.255.255.0
   R2632(config-if)# no shutdown
   R2632(config-if)# exit
   ```

4. 配置Serial接口（连接另一台路由器）：
   ```
   R2632(config)# interface serial 1/2
   R2632(config-if)# ip address 172.16.2.1 255.255.255.0
   R2632(config-if)# clock rate 64000
   R2632(config-if)# no shutdown
   R2632(config-if)# exit
   ```

   > **说明**：`clock rate 64000` 命令设置DCE端的时钟频率为64kbps。在两台路由器通过串行接口直接相连时，必须在DCE端配置时钟信号。

5. 配置静态路由（指向校园外网络）：
   ```
   R2632(config)# ip route 172.16.3.0 255.255.255.0 172.16.2.2
   ```

   > **说明**：也可以使用接口名称指定下一跳：
   > ```
   > R2632(config)# ip route 172.16.3.0 255.255.255.0 serial 1/2
   > ```

6. 保存配置：
   ```
   R2632(config)# exit
   R2632# write memory
   ```

### 步骤3：配置校园外路由器R1762-01

1. 连接到路由器R1762-01的控制台：
   - 在Packet Tracer中，点击路由器图标
   - 选择"CLI"标签页

2. 进入特权模式和全局配置模式：
   ```
   Router> enable
   Router# configure terminal
   Router(config)# hostname R1762-01
   ```

3. 配置FastEthernet接口（连接校园外网络）：
   ```
   R1762-01(config)# interface fastEthernet 1/1
   R1762-01(config-if)# ip address 172.16.3.2 255.255.255.0
   R1762-01(config-if)# no shutdown
   R1762-01(config-if)# exit
   ```

4. 配置Serial接口（连接另一台路由器）：
   ```
   R1762-01(config)# interface serial 1/2
   R1762-01(config-if)# ip address 172.16.2.2 255.255.255.0
   R1762-01(config-if)# no shutdown
   R1762-01(config-if)# exit
   ```

   > **说明**：由于此接口是DTE端，不需要配置时钟频率。

5. 配置静态路由（指向校园内网络）：
   ```
   R1762-01(config)# ip route 172.16.1.0 255.255.255.0 172.16.2.1
   ```

   > **说明**：也可以使用接口名称指定下一跳：
   > ```
   > R1762-01(config)# ip route 172.16.1.0 255.255.255.0 serial 1/2
   > ```

6. 保存配置：
   ```
   R1762-01(config)# exit
   R1762-01# write memory
   ```

### 步骤4：配置模拟校园内PC(交换机S2126G-01)

1. 连接到交换机S2126G-01的控制台：
   - 在Packet Tracer中，点击交换机图标
   - 选择"CLI"标签页

2. 进入特权模式和全局配置模式：
   ```
   Switch> enable
   Switch# configure terminal
   Switch(config)# hostname S2126G-01
   ```

3. 配置VLAN1接口（用于管理）：
   ```
   S2126G-01(config)# interface vlan 1
   S2126G-01(config-if)# ip address 172.16.1.11 255.255.255.0
   S2126G-01(config-if)# no shutdown
   S2126G-01(config-if)# exit
   ```

4. 配置默认网关：
   ```
   S2126G-01(config)# ip default-gateway 172.16.1.1
   ```

   > **说明**：默认网关指向校园内路由器R2632的F1/1接口。

5. 保存配置：
   ```
   S2126G-01(config)# exit
   S2126G-01# write memory
   ```

### 步骤5：配置模拟校园外PC(交换机S2126G-02)

1. 连接到交换机S2126G-02的控制台：
   - 在Packet Tracer中，点击交换机图标
   - 选择"CLI"标签页

2. 进入特权模式和全局配置模式：
   ```
   Switch> enable
   Switch# configure terminal
   Switch(config)# hostname S2126G-02
   ```

3. 配置VLAN1接口（用于管理）：
   ```
   S2126G-02(config)# interface vlan 1
   S2126G-02(config-if)# ip address 172.16.3.22 255.255.255.0
   S2126G-02(config-if)# no shutdown
   S2126G-02(config-if)# exit
   ```

4. 配置默认网关：
   ```
   S2126G-02(config)# ip default-gateway 172.16.3.2
   ```

   > **说明**：默认网关指向校园外路由器R1762-01的F1/1接口。

5. 保存配置：
   ```
   S2126G-02(config)# exit
   S2126G-02# write memory
   ```

## 验证配置结果

### 步骤1：验证路由器接口配置

1. 在路由器R2632上查看接口状态：
   ```
   R2632# show ip interface brief
   ```

   应该看到类似以下输出：
   ```
   Interface              IP-Address      OK? Method Status    Protocol
   FastEthernet1/1        172.16.1.1      YES manual up        up
   Serial1/2              172.16.2.1      YES manual up        up
   ```

2. 在路由器R1762-01上查看接口状态：
   ```
   R1762-01# show ip interface brief
   ```

   应该看到类似以下输出：
   ```
   Interface              IP-Address      OK? Method Status    Protocol
   FastEthernet1/1        172.16.3.2      YES manual up        up
   Serial1/2              172.16.2.2      YES manual up        up
   ```

### 步骤2：验证串行接口详细信息

1. 在R2632上查看串行接口详细信息：
   ```
   R2632# show interface serial 1/2
   ```

   应该能看到以下关键信息：
   - 接口状态为"UP"
   - 时钟频率设置为64000
   - V35 DCE cable（表明这是DCE端）

### 步骤3：检查路由表

1. 在路由器R2632上查看路由表：
   ```
   R2632# show ip route
   ```

   应该看到类似以下输出：
   ```
   C    172.16.1.0/24 is directly connected, FastEthernet1/1
   C    172.16.2.0/24 is directly connected, Serial1/2
   S    172.16.3.0/24 [1/0] via 172.16.2.2
   ```

2. 在路由器R1762-01上查看路由表：
   ```
   R1762-01# show ip route
   ```

   应该看到类似以下输出：
   ```
   S    172.16.1.0/24 [1/0] via 172.16.2.1
   C    172.16.2.0/24 is directly connected, Serial1/2
   C    172.16.3.0/24 is directly connected, FastEthernet1/1
   ```

### 步骤4：测试网络连通性

1. 从校园内PC(S2126G-01)ping校园外PC(S2126G-02)：
   ```
   S2126G-01# ping 172.16.3.22
   ```

   应该看到成功的ping响应：
   ```
   Type escape sequence to abort.
   Sending 5, 100-byte ICMP Echos to 172.16.3.22, timeout is 2 seconds:
   !!!!!
   Success rate is 100 percent (5/5), round-trip min/avg/max = 35/35/35 ms
   ```

2. 从校园外PC(S2126G-02)ping校园内PC(S2126G-01)：
   ```
   S2126G-02# ping 172.16.1.11
   ```

   应该看到成功的ping响应：
   ```
   Type escape sequence to abort.
   Sending 5, 100-byte ICMP Echos to 172.16.1.11, timeout is 2 seconds:
   !!!!!
   Success rate is 100 percent (5/5), round-trip min/avg/max = 35/37/42 ms
   ```

3. 测试从PC到远端网关的连通性：
   ```
   S2126G-01# ping 172.16.3.2
   S2126G-02# ping 172.16.1.1
   ```

## 排除常见问题

### 1. 接口物理状态问题

**现象**：接口状态显示"down"或者"administratively down"

**解决方法**：
- 检查物理连接（在Packet Tracer中查看连接线是否为绿色）
- 确认接口没有被shutdown：
  ```
  Router(config)# interface 接口名称
  Router(config-if)# no shutdown
  ```

### 2. 串行接口问题

**现象**：串行接口显示up，但protocol状态为down

**解决方法**：
- 确认DCE端配置了时钟频率：
  ```
  Router(config)# interface serial 1/2
  Router(config-if)# clock rate 64000
  ```
- 检查线缆类型是否正确（DCE/DTE）
- 确认两端的封装协议一致（默认是HDLC）

### 3. 静态路由配置问题

**现象**：无法ping通远端网络，但本地网络正常

**解决方法**：
- 检查静态路由配置是否正确：
  ```
  Router# show ip route
  ```
- 确认下一跳地址可达
- 检查是否只配置了单向静态路由（需要双向配置）

### 4. PC网关配置问题

**现象**：PC可以ping通同一网段的设备，但无法ping通其他网段

**解决方法**：
- 确认PC配置了正确的默认网关：
  ```
  Switch(config)# ip default-gateway IP地址
  ```
- 确认默认网关本身可达
- 检查到远端网络的路由是否存在

## 扩展知识

### 1. 静态路由和默认路由的区别

**静态路由**：
- 明确指定到达特定目标网络的路径
- 命令格式：`ip route 目标网络 子网掩码 下一跳地址`
- 优先级较高，管理距离为1

**默认路由**：
- 当没有找到更具体的路由时使用
- 命令格式：`ip route 0.0.0.0 0.0.0.0 下一跳地址`
- 相当于"其它所有目的地都走这条路"

### 2. 静态路由的管理距离

管理距离(Administrative Distance, AD)是路由可信度的度量，数值越小表示可信度越高：
- 直连路由：0
- 静态路由：1
- EIGRP汇总路由：5
- 外部BGP：20
- 内部EIGRP：90
- IGRP：100
- OSPF：110
- IS-IS：115
- RIP：120
- 外部EIGRP：170
- 内部BGP：200
- 未知：255（不可达）

可以通过以下命令设置静态路由的管理距离：
```
ip route 网络地址 子网掩码 下一跳 [管理距离]
```

例如：
```
R2632(config)# ip route 172.16.3.0 255.255.255.0 172.16.2.2 150
```

### 3. 浮动静态路由

浮动静态路由是一种备份路由，通过设置较高的管理距离，使其只在主路由失效时才生效：

```
R2632(config)# ip route 172.16.3.0 255.255.255.0 172.16.4.2 150
```

当主静态路由（管理距离为1）失效时，浮动静态路由（管理距离为150）会自动生效。

### 4. 永久静态路由与非永久静态路由

默认情况下，静态路由存在于路由表中，直到被管理员手动删除或存在更优的路由。但有时我们可能希望只有当出口接口工作时，静态路由才有效：

```
R2632(config)# ip route 172.16.3.0 255.255.255.0 Serial1/2 track 1
R2632(config)# ip sla 1
R2632(config-ip-sla)# icmp-echo 172.16.2.2
R2632(config-ip-sla)# frequency 15
R2632(config-ip-sla)# exit
R2632(config)# ip sla schedule 1 start-time now life forever
```

这样配置后，只有当能成功ping通172.16.2.2时，静态路由才会添加到路由表中。

---

通过本教程，您已经学习了如何在Cisco Packet Tracer环境中配置静态路由，实现不同网段之间的通信。静态路由适用于小型网络环境，是网络管理员必须掌握的基本技能。 